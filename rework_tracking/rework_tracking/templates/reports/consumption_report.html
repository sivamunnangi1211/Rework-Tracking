{% extends 'components/body.html' %}
{% block page_title %} Consumption Report {% endblock %}
{% block content %}
    <div class="rework-generation-report-container reports-main-container" style="margin-top: 30px;
     display: flex; justify-content: center; flex-direction: column; padding: 0 30px" >
        <div class="reports-download-container" style="display: flex; justify-content: right; margin: 20px 0;">
            <div id="export_report_button" class="btn btn-primary export-report-button controlytics-button"
            onclick="exportToExcel()">
                Export
                <i class="fa-solid fa-circle-notch fa-spin" hidden id="export_report_button_loader" style="margin-left: 10px;"></i>
            </div>
        </div>
        <div class="reports-table-container mixer-a-container">
            <table style="border: 1px solid black" id="reports_table">
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Number of Pallets Dosed in Mixer A(Nos.)</th>
                        <th>Shift Cumulative (Nos.) {{ current_shift_display_name }}</th>
                        <th>Day Cumulative (Nos.) {{ current_date_display }}</th>
                        <th>Weekly Cumulative (Nos.)</th>
                    </tr>
                </thead>
                <tbody id="reports_table_body">
                    <tr>
                        <td>1</td>
                        <td>Number of Pallets with Metal</td>
                        <td>{{ report_data['mixer_a']['metal']['shift_count'] if report_data['mixer_a'] and report_data['mixer_a']['metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['metal']['day_count']  if report_data['mixer_a'] and report_data['mixer_a']['metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['metal']['weekly_count']  if report_data['mixer_a'] and report_data['mixer_a']['metal'] else 0 }}</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Number of Pallets with Non-Metal</td>
                        <td>{{ report_data['mixer_a']['non_metal']['shift_count']  if report_data['mixer_a'] and report_data['mixer_a']['non_metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['non_metal']['day_count']  if report_data['mixer_a'] and report_data['mixer_a']['non_metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['non_metal']['weekly_count']  if report_data['mixer_a'] and report_data['mixer_a']['non_metal'] else 0 }}</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Total Number of Pallets</td>
                        <td>{{ report_data['mixer_a']['total']['shift_count']  if report_data['mixer_a'] and report_data['mixer_a']['total'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['total']['day_count']  if report_data['mixer_a'] and report_data['mixer_a']['total'] else 0 }}</td>
                        <td>{{ report_data['mixer_a']['total']['weekly_count']  if report_data['mixer_a'] and report_data['mixer_a']['total'] else 0 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="reports-table-container mixer-b-container" style="margin-top: 20px;">
            <table style="border: 1px solid black" id="reports_table">
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Number of Pallets Dosed in Mixer B(Nos.)</th>
                        <th>Shift Cumulative (Nos.) {{ current_shift_display_name }}</th>
                        <th>Day Cumulative (Nos.) {{ current_date_display }}</th>
                        <th>Weekly Cumulative (Nos.)</th>
                    </tr>
                </thead>
                <tbody id="reports_table_body">
                    <tr>
                        <td>1</td>
                        <td>Number of Pallets with Metal</td>
                        <td>{{ report_data['mixer_b']['metal']['shift_count']  if report_data['mixer_b'] and report_data['mixer_b']['metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['metal']['day_count']  if report_data['mixer_b'] and report_data['mixer_b']['metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['metal']['weekly_count']  if report_data['mixer_b'] and report_data['mixer_b']['metal'] else 0 }}</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Number of Pallets with Non-Metal</td>
                        <td>{{ report_data['mixer_b']['non_metal']['shift_count']  if report_data['mixer_b'] and report_data['mixer_b']['non_metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['non_metal']['day_count']  if report_data['mixer_b'] and report_data['mixer_b']['non_metal'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['non_metal']['weekly_count']  if report_data['mixer_b'] and report_data['mixer_b']['non_metal'] else 0 }}</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Total Number of Pallets</td>
                        <td>{{ report_data['mixer_b']['total']['shift_count']  if report_data['mixer_b'] and report_data['mixer_b']['total'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['total']['day_count']  if report_data['mixer_b'] and report_data['mixer_b']['total'] else 0 }}</td>
                        <td>{{ report_data['mixer_b']['total']['weekly_count']  if report_data['mixer_b'] and report_data['mixer_b']['total'] else 0 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function exportToExcel() {
            let table = document.getElementById("reports_table");
            let ws = XLSX.utils.table_to_sheet(table);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rework Generation Report");
            XLSX.writeFile(wb, "rework_generation_report.xlsx");
        }
    </script>
{% endblock %}

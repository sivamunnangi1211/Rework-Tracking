{% extends 'components/body.html' %}
{% block page_title %} Rejected Tags Report {% endblock %}
{% block content %}
    <div class="rejected-report-container reports-main-container" style="margin-top: 30px;
     display: flex; justify-content: center; flex-direction: column; padding: 0 30px" >
        <div class="reports-download-container" style="display: flex; justify-content: right; margin: 20px 0;">
            <div id="export_report_button" class="btn btn-primary export-report-button controlytics-button"
            onclick="exportToExcel()">
                Export
                <i class="fa-solid fa-circle-notch fa-spin" hidden id="export_report_button_loader" style="margin-left: 10px;"></i>
            </div>
        </div>
        <div class="reports-table-container">
            <table style="border: 1px solid black" id="reports_table">
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Rejected Tag</th>
                        <th>Rejected Formulation Name</th>
                        <th>Scrap Type</th>
                        <th>Scanned On</th>
                        <th>Rejected at Machine</th>
                        <th>Rejected On</th>
                        <th>Rejection Reason</th>
                    </tr>
                </thead>
                <tbody id="reports_table_body">
                    {% for report in report_data %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ report['tag_id'] }}</td>
                            <td>{{ report['formulation_name'] }}</td>
                            <td>{{ report['scrap_type_name'] }}</td>
                            <td>{{ report['submitted_datetime'] }}</td>
                            <td>{{ report['rejected_machine_name'] }}</td>
                            <td>{{ report['rejected_datetime'] }}</td>
                            <td>{{ report['rejection_reason'] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function exportToExcel() {
            let table = document.getElementById("reports_table");
            let ws = XLSX.utils.table_to_sheet(table);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rejected Tags Report");
            XLSX.writeFile(wb, "rejected_tags_report.xlsx");
        }
    </script>
{% endblock %}
